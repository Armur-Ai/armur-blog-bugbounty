---
title: "Exploiting Server-Side Request Forgery (SSRF) Vulnerabilities: Gaining Access to Internal Resources and Bypassing Defenses"
description: "This tutorial dives into SSRF attacks, exploring techniques to exploit vulnerable applications, access internal resources, and bypass common SSRF protection mechanisms."
image: "https://armur-ai.github.io/armur-blog-pentest/images/security-fundamentals.png"
icon: "code"
draft: false
---
#### Introduction

Server-Side Request Forgery (SSRF) is a web security vulnerability that allows an attacker to induce the server-side application to make HTTP requests to arbitrary domains chosen by the attacker. This can have significant consequences, as attackers can leverage SSRF to access internal resources, scan internal networks, and even execute commands on the server. 

#### Understanding SSRF

SSRF vulnerabilities typically arise when an application takes user-supplied input (e.g., a URL) and uses it to make a request on behalf of the user. If the application doesn't properly validate or sanitize this input, an attacker can craft malicious URLs to target internal services or resources that are not accessible from the outside.

#### Exploiting SSRF

1. **Identifying Potential SSRF Vulnerabilities:**

   - Look for functionalities that involve fetching content from external resources, such as image processing services, URL shortening services, or web page previews.
   - Pay attention to parameters that accept URLs or file paths as input.

2. **Basic SSRF Exploitation:**

   - **Accessing Internal Resources:**  If the application fetches content from a user-supplied URL, try replacing the URL with the address of an internal service (e.g., `http://127.0.0.1:8080`). If the application displays the content of the internal service, it indicates an SSRF vulnerability.
   - **Port Scanning:**  You can use SSRF to scan internal ports by making requests to different ports on the internal network. Observe the application's responses to determine if a port is open.
   - **Accessing Metadata Services:** Cloud environments often have metadata services that provide information about the server instance. You can use SSRF to access these services (e.g., `http://169.254.169.254/latest/meta-data/`).

3. **Bypassing SSRF Defenses:**

   - **Blacklist Bypass:** If the application has a blacklist of disallowed domains, try using alternative representations of the target URL (e.g., using IP addresses, decimal IP notation, or shortened URLs).
   - **Whitelist Bypass:** If the application has a whitelist of allowed domains, look for open redirects or vulnerabilities in allowed domains that can be used to chain requests to your target.
   - **DNS Rebinding:** Register a domain that initially resolves to a harmless IP address but later changes to the target internal IP address. This can bypass defenses that rely on DNS resolution at the time of the request.

#### Practical Example: Exploiting SSRF in an Image Processing Service

Let's say a web application allows users to upload images and uses an external image processing service to resize them. The application takes the user-supplied URL of the image and sends it to the service. 

1. **Exploitation:** An attacker could replace the image URL with the address of an internal service, such as `http://192.168.1.100:8080/admin`. If the image processing service fetches content from this URL and the application displays the response, it indicates an SSRF vulnerability.

2. **Bypassing Defenses:** If the application has a blacklist that blocks access to internal IP addresses, the attacker could try using a DNS rebinding technique or an alternative representation of the IP address, such as `http://2606:4700:3031::681c:64a4:8080/admin` (IPv6).

#### Remediation and Mitigation

* **Whitelist allowed domains and protocols.**
* **Validate and sanitize user-supplied URLs thoroughly.**
* **Disable unnecessary network protocols on the server.**
* **Enforce least privilege for the application.**
* **Implement proper error handling to avoid information leakage.**

#### Conclusion

SSRF is a serious vulnerability that can allow attackers to access sensitive information and compromise internal systems. By understanding the techniques used to exploit SSRF and the methods for bypassing common defenses, you can better assess and mitigate the risks associated with this vulnerability. 